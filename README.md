# bothelp_tt

## Описание задачи
Есть веб-api, принимающее события (ограничимся 10000 событий) для группы аккаунтов (1000 аккаунтов) и складывающее их в очередь.
Каждое событие связано с определенным аккаунтом и важно, чтобы события аккаунта обрабатывались в том же порядке, в котором поступили в очередь. Обработка события занимает 1 секунду (эмулировать с помощью sleep).  
Сделать обработку очереди событий максимально быстрой на данной конкретной машине.
Код писать на PHP. Можно использовать фреймворки и инструменты такие как RabbitMQ, Redis, MySQL и т. д.

## Реализация

### Стек
PHP 8.2+, RabbitMQ, Nginx

### Описание
Для ускорения обработки очереди использовано шардирование по account_id в событии, каждую очередь единовременно должен обрабатывать только один воркер.
В данной реализации используется 4 шарда, но в теории можно их сделать и больше, если недостаёт скорости обработки

## Запуск

1. Запуск docker:
```bash
cd docker
docker-compose up -d --build
```

2. Запуск теста обработки очереди:
```php
docker exec -it bothelp_tt-php-1 vendor/bin/phpunit
```

## Тесты:
Реализован только один тест, который проверяет порядок обработки событий в очереди и кол-во обработанных событий. \
Задать кол-во генерируемых событий а также диапазон ID аккаунтов можно через `.env.test`:
```text
...

EVENTS_COUNT=<int>
MAX_ACCOUNT_ID=<int>
```
